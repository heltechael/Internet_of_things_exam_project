<html>
    <head>
        <title>IoT Exam Project</title>
        <style>
            table {
                border-collapse: collapse;
            }

            th, td {
                border: 1px solid black;
                padding: 8px;
                text-align: left;
            }
        </style>
        <script>
            async function buttonClick(buttonNumber) {
                const response = await fetch('/button/' + buttonNumber, {method: 'POST'})
                if (response.ok) {
                    alert("Button " + buttonNumber + " clicked!");
                } else {
                    alert("Failed to click Button " + buttonNumber);
                }
            }

            async function updateSensorData() {
                const response = await fetch('/sensor_data');
                const data = await response.json();
                updateDataQueue(data.sensor_data); // Pass only sensor_data array
            }

            setInterval(updateSensorData, 200);

            const maxDataCount = 1;
            let dataQueue = [];

            function updateDataQueue(sensor_data) {
                dataQueue = [...dataQueue, ...sensor_data]; // Use spread operator to concatenate arrays

                if (dataQueue.length > maxDataCount) {
                    dataQueue = dataQueue.slice(-maxDataCount); // Keep the last maxDataCount elements
                }

                renderDataList();
            }

            function renderDataList() {
                let tableHTML = "<tr><th>Temperature</th><th>Humidity</th><th>Pressure</th></tr>";
                dataQueue.forEach(row => {
                    tableHTML += `<tr>
                                    <td>${row.temperature.toFixed(2)}</td>
                                    <td>${row.humidity.toFixed(2)}</td>
                                    <td>${row.pressure.toFixed(2)}</td>
                                  </tr>`;
                });

                document.getElementById("sensorDataTable").innerHTML = tableHTML;
            }
        </script>
    </head>
    <body>
        <h1>Weather Station</h1>
        <button onclick="buttonClick(1)">Start Measuring</button>
        <button onclick="buttonClick(2)">Stop Measuring</button>
        <button onclick="buttonClick(3)">Button 3</button>
        <button onclick="buttonClick(4)">Button 4</button>
        
        <h2>Sensor Data</h2>
        <table id="sensorDataTable">
            <tr><th>Temperature</th><th>Humidity</th><th>Pressure</th></tr>
        </table>
    </body>
</html>
